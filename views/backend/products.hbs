<div style="margin-bottom: 16px; display:flex; gap:10px;">
  <a href="/admin/dashboard" class="admin-btn admin-btn-secondary">
    ← Return to Dashboard
  </a>
</div>

<div class="admin-page">
  <section class="admin-content">
    <h1>Products</h1>
    
    {{#if selectedStore}}
      <!-- ✅ Create Product -->
    <form action="/admin/products/create" method="POST" enctype="multipart/form-data" class="card product-form">
  <h3>Add Product for: {{selectedStore.name}} ({{selectedStore.type}})</h3>
  <input type="hidden" name="storeId" value="{{selectedStore._id}}" />
  <div class="form-grid">
    <label>Name (EN)</label>
    <input name="name_en" required />
    <label>Name (AR)</label>
    <input name="name_ar" />
   <label>Category</label>
    <input type="text" value="{{selectedStore.type}}" disabled>
    <input type="hidden" name="category" value="{{selectedStore.type}}">
    <label>Price</label>
    <input name="price" type="number" step="0.01" required />
    <label>Image</label>
    <input type="file" name="image" accept="image/*" />
    <label>Offer?</label>
    <select name="offer">
      <option value="false">No</option>
      <option value="true">Yes</option>
    </select>
    <label>Offer Price (optional)</label>
    <input name="offerPrice" type="number" step="0.01" />
    <label>Details (EN)</label>
    <textarea name="details_en"></textarea>
    <label>Details (AR)</label>
    <textarea name="details_ar"></textarea>
    <label>Active</label>
    <select name="isActive">
      <option value="true" selected>Yes</option>
      <option value="false">No</option>
    </select>
  </div>
  <button type="submit" class="full-width-btn">Create Product</button>
</form>
      <hr/>
  <h3 style="font-size:x-large; text-align:center;background-color:rgb(200, 89, 14)">Edit Existing Products</h3>

<table class="grid-admin">
  <thead style="text-align:center">
    <tr>
      <th>Type</th>
      <th>Name</th>
      <th>Name (AR)</th>
      <th>Price</th>
      <th>Offer</th>
      <th>Offer Price</th>
      <th>Image</th>
      <th>Active</th>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody>
    {{#each products}}
      <tr>

        {{!-- VALID HTML: define the update form once (no inputs inside) --}}
        <td>
          <form id="updateForm-{{_id}}"
                action="/admin/products/update/{{_id}}"
                method="POST"
                enctype="multipart/form-data">
            <input type="hidden" name="returnTo" value="/admin/products?page={{../page}}&{{../queryBase}}">
          </form>

          <input type="text" class="cell-input w-sm" value="{{this.storeSnapshot.type}}" disabled>
          <input type="hidden" name="category" value="{{this.storeSnapshot.type}}" form="updateForm-{{_id}}">
        </td>

        <td>
          <input name="name" value="{{name}}" form="updateForm-{{_id}}" class="cell-input" required />
        </td>

        <td>
          <input name="name_ar" value="{{name_ar}}" form="updateForm-{{_id}}" class="cell-input" dir="rtl" />
        </td>

        <td>
          <input name="price" type="number" step="0.01" value="{{price}}" form="updateForm-{{_id}}" class="cell-input w-sm" />
        </td>

        <td>
          <select name="offer" form="updateForm-{{_id}}" class="cell-select w-sm">
            <option value="false" {{#unless offer}}selected{{/unless}}>No</option>
            <option value="true"  {{#if offer}}selected{{/if}}>Yes</option>
          </select>
        </td>

        <td>
          <input name="offerPrice" type="number" step="0.01" value="{{offerPrice}}" form="updateForm-{{_id}}" class="cell-input w-sm" />
        </td>

        <td>
          <div class="img-cell">
            {{#if image}}<img src="{{image}}" alt="" class="thumb" />{{/if}}
            <input type="file" name="image" accept="image/*" form="updateForm-{{_id}}" class="file-input" />
          </div>
        </td>

        <td>
          <select name="isActive" form="updateForm-{{_id}}" class="cell-select w-sm">
            <option value="true"  {{#if isActive}}selected{{/if}}>Yes</option>
            <option value="false" {{#unless isActive}}selected{{/unless}}>No</option>
          </select>
        </td>

        <td class="actions-cell">
          <button type="submit" form="updateForm-{{_id}}" class="btn-save" style="background-color: rgb(53, 236, 53);">
            Save
          </button>

          <form action="/admin/products/toggle/{{_id}}" method="POST" class="inline-form" style="margin:0;">
            <input type="hidden" name="returnTo" value="/admin/products?page={{../page}}&{{../queryBase}}">
            <button type="submit" class="btn-toggle" style="background-color: rgb(250, 250, 93);">
              {{#if isActive}}Disable{{else}}Enable{{/if}}
            </button>
          </form>

          <form action="/admin/products/delete/{{_id}}" method="POST" class="inline-form" style="margin:0;">
            <input type="hidden" name="returnTo" value="/admin/products?page={{../page}}&{{../queryBase}}">
            <button type="submit" class="btn-toggle" style="background-color: rgb(250, 32, 32);"
                    onclick="return confirm('Delete this product?');">
              Delete
            </button>
          </form>
        </td>

      </tr>
    {{/each}}
  </tbody>
</table>

    
    {{else}}
      <div class="card">
        <h3>No store selected</h3>
        <p>Please choose a store above to add and manage products.</p>
      </div>
    {{/if}}
  </section>
</div>
