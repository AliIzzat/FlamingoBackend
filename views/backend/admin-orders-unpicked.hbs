<h1 style="margin:0 0 14px;">Orders</h1>

<!-- Tabs / Filters -->
<div style="display:flex; gap:10px; margin: 10px 0 14px; flex-wrap:wrap;">
  {{#each filters}}
    <a
      href="/admin/orders?filter={{this}}"
      style="
        padding:8px 12px;
        border-radius:999px;
        text-decoration:none;
        border:1px solid #ddd;
        {{#if (eq ../activeFilter this)}}background:#111827;color:#fff;border-color:#111827;{{/if}}
      "
    >
      {{this}}
    </a>
  {{/each}}
</div>

{{#if orders.length}}
  <table style="width:100%; border-collapse:collapse; background:#fff;">
    <thead>
      <tr style="background:#f9fafb;">
        <th style="text-align:left; padding:10px; border:1px solid #e5e7eb;">Order</th>
        <th style="text-align:left; padding:10px; border:1px solid #e5e7eb;">Customer</th>
        <th style="text-align:left; padding:10px; border:1px solid #e5e7eb;">Status</th>
        <th style="text-align:left; padding:10px; border:1px solid #e5e7eb;">Driver</th>
        <th style="text-align:left; padding:10px; border:1px solid #e5e7eb;">Age</th>
        <th style="text-align:left; padding:10px; border:1px solid #e5e7eb;">Total</th>
        <th style="text-align:left; padding:10px; border:1px solid #e5e7eb; width:360px;">Actions</th>
      </tr>
    </thead>

    <tbody>
      {{#each orders}}
        <tr>
          <td style="padding:10px; border:1px solid #e5e7eb;">
            <div style="font-weight:700;">{{_id}}</div>
            <div style="font-size:12px; color:#6b7280;">
              {{#if pickup.addressText}}{{pickup.addressText}}{{else}}-{{/if}}
            </div>
          </td>

          <td style="padding:10px; border:1px solid #e5e7eb;">
            <div style="font-weight:600;">{{customer.name}}</div>
            <div style="font-size:12px; color:#6b7280;">{{customer.phone}}</div>
            <div style="font-size:12px; color:#6b7280;">{{customer.addressText}}</div>
          </td>

          <td style="padding:10px; border:1px solid #e5e7eb;">
            <span style="padding:5px 10px; border-radius:999px; border:1px solid #ddd;">
              {{delivery.status}}
            </span>
          </td>

          <td style="padding:10px; border:1px solid #e5e7eb;">
            {{driverName}}
          </td>

          <td style="padding:10px; border:1px solid #e5e7eb;">
            {{createdSince}}
          </td>

          <td style="padding:10px; border:1px solid #e5e7eb;">
            QAR {{totals.total}}
          </td>

          <td style="padding:10px; border:1px solid #e5e7eb;">
            <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
              <!-- View -->
              <a href="/admin/orders/{{_id}}" style="padding:7px 10px; border:1px solid #ddd; border-radius:8px; text-decoration:none;">
                View
              </a>

              <!-- Assign driver -->
              <form method="POST" action="/admin/orders/{{_id}}/assign-driver" style="display:flex; gap:6px; align-items:center;">
                <input type="hidden" name="returnFilter" value="{{../activeFilter}}" />
                <select name="driverId" required style="padding:7px 8px; border:1px solid #ddd; border-radius:8px;">
                  <option value="">Assign driverâ€¦</option>
                  {{#each ../drivers}}
                    <option value="{{_id}}">
                      {{#if name}}{{name}}{{else}}{{username}}{{/if}}
                    </option>
                  {{/each}}
                </select>
                <button type="submit" style="padding:7px 10px; border:1px solid #111827; background:#111827; color:#fff; border-radius:8px; cursor:pointer;">
                  Assign
                </button>
              </form>

              <!-- Cancel -->
              <form method="POST" action="/admin/orders/{{_id}}/cancel" onsubmit="return confirm('Cancel this order?');">
                <input type="hidden" name="returnFilter" value="{{../activeFilter}}" />
                <button type="submit" style="padding:7px 10px; border:1px solid #ef4444; background:#fff; color:#ef4444; border-radius:8px; cursor:pointer;">
                  Cancel
                </button>
              </form>
            </div>
          </td>
        </tr>
      {{/each}}
    </tbody>
  </table>
{{else}}
  <div style="padding:14px; border:1px solid #e5e7eb; background:#fff; border-radius:10px;">
    No orders found for <b>{{activeFilter}}</b>.
  </div>
{{/if}}


